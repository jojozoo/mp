<%= render 'ueditor' %>
<%= simple_form_for @topic, validate: true do |f| %>
    <%= f.input :title %>
    <%= f.input :cate_id, collection: Tag.where(channel: '文章').select('id,name'), include_blank: false %>
    <div id="topic_content"></div>
    <%#= f.input :content, as: :text, input_html: {style: 'height:200px;'} %>
    
    
    <div class="form-group select required topic_tags">
        <label class="select required col-sm-2 control-label" for="topic_tags">
            <abbr title="required">*</abbr>
            标签
        </label>
        <div class="col-sm-6 input-text-add">
            <div class="input-group">
                <input class="string optional form-control" id="topic_tags" maxlength="4" name="topic[tags]" size="4" type="text" data-validate="true">
                <input id="topic_tags_id" name="topic_tags_id" type="hidden" value="">
                <span class="input-group-addon custom-modal"> 
                    <i class="icon-tag"></i>
                </span>
            </div>
            <div class="modal fade" id="custom-modal" style="display: none;" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">标签选择</h4>
                        </div>
                        <div class="modal-body">
                            <div class="taglabel"></div>
                            <div class="taglabelitems"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <%= f.input :original, :collection => [['原创', true], ['转载', false]], :as => :radio_buttons, :item_wrapper_class => 'radio-inline' %>
    <div class="form-group string optional">
        <label class="string optional col-sm-2 control-label" style="text-align:left;"></label>
        <div class="col-sm-6 input-text-add">
            <span class="checkbox">
                <input id="form_agreement" name="form_agreement" type="checkbox">
                <label for="form_agreement">
                    我已认真阅读并同意《
                    <a href="/sites" target="_blank">漫拍指导原则</a>
                    》和《
                    <a href="/sites" target="_blank">免责声明</a>
                    》。
                </label>
            </span>
        </div>
    </div>

    <div class="form-group string">
        <label class="string optional col-sm-2 control-label"></label>
        <div class="col-sm-6 input-text-add">
            <input class="btn btn-info" name="commit" type="submit" value="发布话题">
        </div>
    </div>
<% end %>

<script type="text/javascript">
$(function(){
    TAGS = <%= Tag.where(channel: '文章').select('id,name,cate').group_by{|t| t.cate}.to_json.html_safe %>;
    for(var p in TAGS){
        $(".taglabel").append("<a href='javascript:void(0);' class='tlb10 taglabelrow'>"+p+"</a>");
    }
    $(document).on("click", ".taglabelrow", function(){
        var list, index, item;
        list = TAGS[$(this).text()];
        $(".taglabelitems").html('');
        for(index in list){
            item = list[index];
            $("<a href='javascript:void(0);' class='tlb10 taglabeltarget' tid='" + item.id + "'>" + item.name + "</a>").appendTo(".taglabelitems");
        }
    });
    $(document).on("click", ".taglabeltarget", function(){
        var _id, name;
        _id = $(this).attr("tid");
        name = $(this).text();
        $("#topic_tags").val(name);
        $("#topic_tags_id").val(_id);
        $('#custom-modal').modal('hide');
    });
    
    $(".taglabel a:eq(0)").trigger('click');
})
</script>
<style type="text/css">
.tlb10{
    margin-right: 10px;
}
.taglabelitems{
    border-top: 1px solid #ccc;
    margin-top: 10px;
    padding-top: 10px;
}
</style>